{% extends "layout.html" %}

{% block content %}
  <div class="mesh-card bg-white rounded-2xl p-6">
    <h2 class="text-lg font-semibold">Services</h2>
    <div class="overflow-x-auto mt-4">
      <table class="table w-full">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Generation</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for service in services %}
            <tr>
              <td class="mono">{{ service.id }}</td>
              <td>{{ service.name }}</td>
              <td class="mono">{{ service.generation }}</td>
              <td>{{ service.description or "-" }}</td>
              <td>
                <div class="flex gap-2">
                  <button class="btn btn-xs btn-outline" onclick="serviceAction('{{ service.id }}', 'rollout')">Rollout</button>
                  <button class="btn btn-xs btn-outline" onclick="serviceAction('{{ service.id }}', 'rollback')">Rollback</button>
                </div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5" class="text-center text-slate-400">No services defined yet.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <script>
    async function serviceAction(serviceId, action) {
      const response = await fetch(`/services/${serviceId}/${action}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: "{}"
      });
      if (response.ok) {
        window.location.reload();
      }
    }
  </script>
{% endblock %}
